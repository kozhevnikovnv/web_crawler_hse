<!DOCTYPE html>
<!--
  Minimal Mistakes Jekyll Theme 4.21.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
--><html class="no-js" lang="ru">
<head>
<meta charset="utf-8"/>
<!-- begin _includes/seo.html --><title>ORM | Михаил Коротеев</title>
<meta content="Работа с БД" name="description"/>
<meta content="Михаил Коротеев" name="author"/>
<meta content="Михаил Коротеев" property="article:author"/>
<meta content="article" property="og:type"/>
<meta content="ru_RU" property="og:locale"/>
<meta content="Михаил Коротеев" property="og:site_name"/>
<meta content="ORM" property="og:title"/>
<meta content="https://koroteev.site/text/wd43/" property="og:url"/>
<meta content="Работа с БД" property="og:description"/>
<meta content="https://koroteev.site/assets/images/android-chrome-192x192.png" property="og:image"/>
<meta content="@koroteev_m" name="twitter:site"/>
<meta content="ORM" name="twitter:title"/>
<meta content="Работа с БД" name="twitter:description"/>
<meta content="https://koroteev.site/text/wd43/" name="twitter:url"/>
<meta content="summary" name="twitter:card"/>
<meta content="https://koroteev.site/assets/images/android-chrome-192x192.png" name="twitter:image"/>
<meta content="2022-09-27T12:49:07+00:00" property="article:published_time"/>
<link href="https://koroteev.site/text/wd43/" rel="canonical"/>
<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Михаил Коротеев",
      "url": "https://koroteev.site/"
    
  }
</script>
<meta content="77706580" name="yandex-verification"/>
<!-- end _includes/seo.html -->
<link href="/feed.xml" rel="alternate" title="Михаил Коротеев Feed" type="application/atom+xml"/>
<!-- https://t.co/dKP3o1e -->
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>
<!-- For all browsers -->
<link href="/assets/css/main.css" rel="stylesheet"/>
<link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" rel="stylesheet"/>
<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->
<!-- start custom head snippets -->
<style type="text/css">
.accordion {
  border: 1px solid white;
  padding: 0 10px;
  margin: 0 auto;
  list-style: none outside;
}

.accordion > * + * { border-top: 1px solid white; }

.accordion-item-hd {
  display: block;
  padding: 15px 30px 15px 0;
  position: relative;
  cursor: pointer;
  font-size: 18px;
  font-weight: bold;
}

.accordion-item-input:checked ~ .accordion-item-bd {
  max-height: 1000px;
  padding-top: 15px;
  margin-bottom: 15px;
  -webkit-transition: max-height 1s ease-in, margin .3s ease-in, padding .3s ease-in;
  transition: max-height 1s ease-in, margin .3s ease-in, padding .3s ease-in;
}

.accordion-item-input:checked ~ .accordion-item-hd > .accordion-item-hd-cta {
  -webkit-transform: rotate(0);
  -ms-transform: rotate(0);
  transform: rotate(0);
}

.accordion-item-hd-cta {
  display: block;
  width: 30px;
  position: absolute;
  top: calc(50% - 6px );
  /*minus half font-size*/
  right: 0;
  pointer-events: none;
  -webkit-transition: -webkit-transform .3s ease;
  transition: transform .3s ease;
  -webkit-transform: rotate(-180deg);
  -ms-transform: rotate(-180deg);
  transform: rotate(-180deg);
  text-align: center;
  font-size: 12px;
  line-height: 1;
}

.accordion-item-bd {
  max-height: 0;
  margin-bottom: 0;
  overflow: hidden;
  -webkit-transition: max-height .15s ease-out, margin-bottom .3s ease-out, padding .3s ease-out;
  transition: max-height .15s ease-out, margin-bottom .3s ease-out, padding .3s ease-out;
}

.accordion-item-input {
  clip: rect(0 0 0 0);
  width: 1px;
  height: 1px;
  margin: -1;
  overflow: hidden;
  position: absolute;
  left: -9999px;
}
</style>
<!-- insert favicons. use https://realfavicongenerator.net/ -->
<!-- end custom head snippets -->
</head>
<body class="layout--textbook_page wide">
<nav class="skip-links">
<h2 class="screen-reader-text">Skip links</h2>
<ul>
<li><a class="screen-reader-shortcut" href="#site-nav">Skip to primary navigation</a></li>
<li><a class="screen-reader-shortcut" href="#main">Skip to content</a></li>
<li><a class="screen-reader-shortcut" href="#footer">Skip to footer</a></li>
</ul>
</nav>
<!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->
<div class="masthead">
<div class="masthead__inner-wrap">
<div class="masthead__menu">
<nav class="greedy-nav" id="site-nav">
<a class="site-logo" href="/"><img alt="" src="/assets/images/android-chrome-192x192.png"/></a>
<a class="site-title" href="/">
          Михаил Коротеев
          <span class="site-subtitle">Личный сайт</span>
</a>
<ul class="visible-links"><li class="masthead__menu-item">
<a href="/os">UNIX</a>
</li><li class="masthead__menu-item">
<a href="/ml">ML</a>
</li><li class="masthead__menu-item">
<a href="/md">Android</a>
</li><li class="masthead__menu-item">
<a href="/courses">Все курсы</a>
</li><li class="masthead__menu-item">
<a href="/blog/">Блог</a>
</li><li class="masthead__menu-item">
<a href="/science">Проекты</a>
</li></ul>
<button class="greedy-nav__toggle hidden" type="button">
<span class="visually-hidden">Выпадающее меню</span>
<div class="navicon"></div>
</button>
<ul class="hidden-links hidden"></ul>
</nav>
</div>
</div>
</div>
<div class="initial-content">
<div id="main" role="main">
<nav class="toc page__content">
<header><h4 class="nav__title"><i class="fas fa-file-alt"></i> Содержание</h4></header>
<ul class="toc__menu">
<li><a href="#работа-с-бд">Работа с БД</a>
<ul>
<li><a href="#cassandra">Cassandra</a></li>
<li><a href="#couchdb">CouchDB</a></li>
<li><a href="#leveldb">LevelDB</a></li>
<li><a href="#mysql">MySQL</a></li>
<li><a href="#mongodb">MongoDB</a></li>
<li><a href="#neo4j">Neo4j</a></li>
<li><a href="#postgresql">PostgreSQL</a></li>
<li><a href="#redis">Redis</a></li>
<li><a href="#sqlite">SQLite</a></li>
<li><a href="#elasticsearch">ElasticSearch</a></li>
</ul>
</li>
<li><a href="#что-такое-orm">Что такое ORM?</a></li>
<li><a href="#основы-sequelize">Основы Sequelize</a>
<ul>
<li><a href="#подключение-к-бд">Подключение к БД</a></li>
</ul>
</li>
<li><a href="#модели">Модели</a>
<ul>
<li><a href="#определение-моделей">Определение моделей</a></li>
<li><a href="#плюрализация-названия">Плюрализация названия</a></li>
<li><a href="#явное-задание-названия">Явное задание названия</a></li>
<li><a href="#запись-изменений-в-бд">Запись изменений в БД</a></li>
<li><a href="#удаление-всех-таблиц">Удаление всех таблиц</a></li>
<li><a href="#автоматические-поля">Автоматические поля</a></li>
<li><a href="#задание-типа-поля">Задание типа поля</a></li>
<li><a href="#типы-данных">Типы данных</a></li>
<li><a href="#uuid">UUID</a></li>
<li><a href="#настройка-колонки">Настройка колонки.</a></li>
</ul>
</li>
<li><a href="#экземпляры">Экземпляры</a>
<ul>
<li><a href="#создание-и-обновление-экземпляра">Создание и обновление экземпляра</a></li>
<li><a href="#удаление-и-перезагрузка-экземпляра">Удаление и перезагрузка экземпляра</a></li>
<li><a href="#сохранение-отдельных-полей">Сохранение отдельных полей</a></li>
<li><a href="#автоматическое-увеличение-значения-поля">Автоматическое увеличение значения поля</a></li>
<li><a href="#автоматическое-увеличение-значения-нескольких-полей">Автоматическое увеличение значения нескольких полей</a></li>
</ul>
</li>
<li><a href="#основы-выполнения-запросов">Основы выполнения запросов</a>
<ul>
<li><a href="#создание-экземпляра">Создание экземпляра</a></li>
<li><a href="#создание-экземпляра-с-определёнными-полями">Создание экземпляра с определёнными полями</a></li>
<li><a href="#получение-экземпляра">Получение экземпляра</a></li>
<li><a href="#выборка-полей">Выборка полей</a></li>
<li><a href="#операторы">Операторы</a></li>
<li><a href="#более-сложные-запросы">Более сложные запросы</a></li>
<li><a href="#обновление-экземпляра">Обновление экземпляра</a></li>
<li><a href="#удаление-экземпляра">Удаление экземпляра</a></li>
<li><a href="#создание-нескольких-экземпляров-одновременно">Создание нескольких экземпляров одновременно</a></li>
<li><a href="#сортировка-и-группировка">Сортировка и группировка</a></li>
<li><a href="#полезные-операторы">Полезные операторы</a></li>
</ul>
</li>
<li><a href="#поисковые-запросы">Поисковые запросы</a>
<ul>
<li><a href="#findandcountall">findAndCountAll()</a></li>
</ul>
</li>
<li><a href="#геттеры-сеттеры-и-виртуальные-атрибуты">Геттеры, сеттеры и виртуальные атрибуты</a>
<ul>
<li><a href="#автоматический-вызов-сеттера">Автоматический вызов сеттера</a></li>
<li><a href="#совместное-использование">Совместное использование</a></li>
<li><a href="#сжатие-данных">Сжатие данных</a></li>
<li><a href="#валидация-и-ограничения">Валидация и ограничения</a></li>
<li><a href="#validatorjs">validator.js</a></li>
<li><a href="#кастомизация-сообщения-об-ошибке">Кастомизация сообщения об ошибке</a></li>
<li><a href="#кастомные-валидаторы-для-нулевых-полей">Кастомные валидаторы для нулевых полей</a></li>
<li><a href="#валидация-модели-в-целом">Валидация модели в целом</a></li>
</ul>
</li>
<li><a href="#необработанные-запросы">Необработанные запросы</a>
<ul>
<li><a href="#пример-использования-других-настроек">Пример использования других настроек</a></li>
<li><a href="#настройка-nest">Настройка nest</a></li>
<li><a href="#замены-в-запросе">Замены в запросе</a></li>
<li><a href="#привязка-параметров">Привязка параметров</a></li>
</ul>
</li>
</ul>
</nav>
<article class="page" itemscope="" itemtype="https://schema.org/CreativeWork" style="width: 95%">
<meta content="ORM" itemprop="headline"/>
<meta content="Работа с БД" itemprop="description"/>
<meta content="2022-09-27T12:49:07+00:00" itemprop="datePublished"/>
<div class="page__inner-wrap">
<header>
<h1 class="page__title" id="page-title" itemprop="headline">ORM
</h1>
<p class="page__meta">
<span class="page__meta-readtime">
<i aria-hidden="true" class="far fa-clock"></i>
        
          9 мин на чтение
        
        
          
         (15.411 символов)
                
      </span>
</p>
</header>
<section class="page__content" itemprop="text">
<h3 id="работа-с-бд">Работа с БД</h3>
<h4 id="cassandra">Cassandra</h4>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-80.png" style="width: 800px;" title="ORM"/></p>
<h4 id="couchdb">CouchDB</h4>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-81.png" style="width: 800px;" title="ORM"/></p>
<h4 id="leveldb">LevelDB</h4>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-82.png" style="width: 800px;" title="ORM"/></p>
<h4 id="mysql">MySQL</h4>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-83.png" style="width: 800px;" title="ORM"/></p>
<h4 id="mongodb">MongoDB</h4>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-84.png" style="width: 800px;" title="ORM"/></p>
<h4 id="neo4j">Neo4j</h4>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-85.png" style="width: 800px;" title="ORM"/></p>
<h4 id="postgresql">PostgreSQL</h4>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-86.png" style="width: 800px;" title="ORM"/></p>
<h4 id="redis">Redis</h4>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-87.png" style="width: 800px;" title="ORM"/></p>
<h4 id="sqlite">SQLite</h4>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-88.png" style="width: 800px;" title="ORM"/></p>
<h4 id="elasticsearch">ElasticSearch</h4>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-89.png" style="width: 800px;" title="ORM"/></p>
<h3 id="что-такое-orm">Что такое ORM?</h3>
<p>ORM также может означать: англ. Object Role Model, рус. Модель ролей объекта — методика концептуального проектирования информационных систем, включающая собственную графическую нотацию.</p>
<p>ORM (англ. Object-Relational Mapping, рус. объектно-реляционное отображение, или преобразование) — технология программирования, которая связывает базы данных с концепциями объектно-ориентированных языков программирования, создавая «виртуальную объектную базу данных». Существуют как проприетарные, так и свободные реализации этой технологии. Подход реализует концепцию «абстракция от хранилищ».</p>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-1.png" style="width: 800px;" title="ORM"/></p>
<p>Необходимо обеспечить работу с данными в терминах классов, а не таблиц данных, и, напротив, преобразовать термины и данные классов в данные, пригодные для хранения в СУБД. В общем, необходимо избавиться от необходимости писать SQL-код для взаимодействия в СУБД.</p>
<p>Принцип действия
Разработано множество пакетов, устраняющих необходимость в преобразовании объектов для хранения в реляционных базах данных.</p>
<p>Некоторые пакеты решают эту проблему, предоставляя библиотеки классов, способных выполнять такие преобразования автоматически. Имея список таблиц в базе данных и объектов в программе, они автоматически преобразуют запросы из одного вида в другой. В результате, например, запроса объекта «человек» необходимый SQL-запрос будет сформирован и выполнен, а результаты «волшебным» образом преобразованы в объекты «номер телефона» внутри программы.</p>
<p>С точки зрения программиста система должна выглядеть как постоянное хранилище объектов. Он может просто создавать объекты и работать с ними как обычно, а они автоматически будут сохраняться в реляционной базе данных.</p>
<p>На практике всё не так просто и очевидно. Все системы ORM обычно проявляют себя в том или ином виде, уменьшая в некотором роде возможность игнорирования базы данных. Более того, слой транзакций может быть медленным и неэффективным (особенно в терминах сгенерированного SQL). Все это может привести к тому, что программы будут работать медленнее и использовать больше памяти, чем программы, написанные «вручную».</p>
<p>Но ORM избавляет программиста от написания большого количества кода, часто однообразного и подверженного ошибкам, тем самым значительно повышая скорость разработки. Кроме того, большинство современных реализаций ORM позволяют программисту при необходимости самому жёстко задать код SQL-запросов, который будет использоваться при тех или иных действиях (сохранение в базу данных, загрузка, поиск и т. д.) с постоянным объектом.</p>
<p>Чтобы этот чудесный подход работал необходимо движение база данных -&gt; ORM -&gt; объекты. Наоборот это работает только на очень маленьких БД.</p>
<p>Оказывается, я 15 лет назад уже использовал этот подход, когда хранил данные экземпляров классов в файле, но я не догадался воткнуть между файлами и классами SQL. Наверное нужно предложить убрать прокладку в виде SQL и назвать это продвинутым ORM.</p>
<h3 id="основы-sequelize">Основы Sequelize</h3>
<p>Sequelize — это ORM (Object-Relational Mapping — объектно-реляционное отображение или преобразование) для работы с такими СУБД (системами управления (реляционными) базами данных, Relational Database Management System, RDBMS), как Postgres, MySQL, MariaDB, SQLite и MSSQL. Это далеко не единственная ORM для работы с названными базами данных (далее — БД), но, лга одна из самых продвинутых и, что называется, “battle tested” (проверенных временем).</p>
<p>ORM хороши тем, что позволяют взаимодействовать с БД на языке приложения (JavaScript), т.е. без использования специально предназначенных для этого языков (SQL). Тем не менее, существуют ситуации, когда запрос к БД легче выполнить с помощью SQL (или можно выполнить только c помощью него).</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>yarn add sequelize
npm i sequelize
</pre></td></tr></tbody></table></code></pre></div></div>
<h4 id="подключение-к-бд">Подключение к БД</h4>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-2.png" style="width: 800px;" title="ORM"/></p>
<p>Проверка подключения. По умолчанию после того, как установки соединения, оно остается открытым. Для его закрытия следует вызвать метод sequelize.close().</p>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-3.png" style="width: 800px;" title="ORM"/></p>
<h3 id="модели">Модели</h3>
<p>Модель — это абстракция, представляющая таблицу в БД.</p>
<p>Модель сообщает Sequelize несколько вещей о сущности (entity), которую она представляет: название таблицы, то, какие колонки она содержит (и их типы данных) и др.</p>
<p>У каждой модели есть название. Это название не обязательно должно совпадать с названием соответствующей таблицы. Обычно, модели именуются в единственном числе (например, User), а таблицы — во множественном (например, Users). Sequelize выполняет плюрализацию (перевод значения из единственного числа во множественное) автоматически.</p>
<p>Модели могут определяться двумя способами:</p>
<ul>
<li>путем вызова sequelize.define(modelName, attributes, options)</li>
<li>путем расширения класса Model и вызова init(attributes, options)</li>
</ul>
<p>После определения, модель доступна через sequelize.model + название модели.</p>
<h4 id="определение-моделей">Определение моделей</h4>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-4.png" style="width: 800px;" title="ORM"/></p>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-5.png" style="width: 800px;" title="ORM"/></p>
<h4 id="плюрализация-названия">Плюрализация названия</h4>
<p>Автоматическую плюрализацию названия таблицы можно отключить с помощью настройки freezeTableName, как на слайде вверху
или глобально, как на слайде внизу
В этом случае таблица будет называться User.</p>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-6.png" style="width: 800px;" title="ORM"/></p>
<h4 id="явное-задание-названия">Явное задание названия</h4>
<p>Название таблицы может определяться в явном виде:
В этом случае таблица будет называться Employees.</p>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-7.png" style="width: 800px;" title="ORM"/></p>
<h4 id="запись-изменений-в-бд">Запись изменений в БД</h4>
<p>Синхронизация модели с таблицей:</p>
<ul>
<li>User.sync() — создает таблицу при отсутствии (существующая таблица остается неизменной)</li>
<li>User.sync({ force: true }) — удаляет существующую таблицу и создает новую</li>
<li>User.sync({ alter: true }) — приводит таблицу в соответствие с моделью</li>
</ul>
<p>Возвращает промис
Синхронизация всех моделей
Удаление таблицы</p>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-8.png" style="width: 800px;" title="ORM"/></p>
<h4 id="удаление-всех-таблиц">Удаление всех таблиц</h4>
<p>Удаление всех таблиц:
Sequelize принимает настройку match с регулярным выражением, позволяющую определять группу синхронизируемых таблиц:
Обратите внимание: вместо синхронизации в продакшне следует использовать миграции.</p>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-9.png" style="width: 800px;" title="ORM"/></p>
<h4 id="автоматические-поля">Автоматические поля</h4>
<p>По умолчанию Sequelize автоматически добавляет в создаваемую модель поля createAt и updatedAt с типом DataTypes.DATE. Это можно изменить как на слайде слева.
Названные поля можно отключать по отдельности и переименовывать как на слайде справа.</p>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-10.png" style="width: 800px;" title="ORM"/></p>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-11.png" style="width: 800px;" title="ORM"/></p>
<h4 id="задание-типа-поля">Задание типа поля</h4>
<p>Если для колонки определяется только тип данных, синтаксис определения атрибута может быть сокращен следующим образом как на слайде слева:
По умолчанию значением колонки является NULL. Это можно изменить с помощью настройки defaultValue (определив “дефолтное” значение) как на слайде справа сверху:
В качестве дефолтных могут использоваться специальные значения как на слайде справа внизу.</p>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-12.png" style="width: 800px;" title="ORM"/></p>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-13.png" style="width: 800px;" title="ORM"/></p>
<h4 id="типы-данных">Типы данных</h4>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-14.png" style="width: 800px;" title="ORM"/></p>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-15.png" style="width: 800px;" title="ORM"/></p>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-16.png" style="width: 800px;" title="ORM"/></p>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-18.png" style="width: 800px;" title="ORM"/></p>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-19.png" style="width: 800px;" title="ORM"/></p>
<h4 id="uuid">UUID</h4>
<p>UUID может генерироваться автоматически:</p>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-17.png" style="width: 800px;" title="ORM"/></p>
<h4 id="настройка-колонки">Настройка колонки.</h4>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-20.png" style="width: 800px;" title="ORM"/></p>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-21.png" style="width: 800px;" title="ORM"/></p>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-22.png" style="width: 800px;" title="ORM"/></p>
<h3 id="экземпляры">Экземпляры</h3>
<p>Наш начальный код будет выглядеть следующим образом:</p>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-23.png" style="width: 800px;" title="ORM"/></p>
<h4 id="создание-и-обновление-экземпляра">Создание и обновление экземпляра</h4>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-24.png" style="width: 800px;" title="ORM"/></p>
<h4 id="удаление-и-перезагрузка-экземпляра">Удаление и перезагрузка экземпляра</h4>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-25.png" style="width: 800px;" title="ORM"/></p>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-26.png" style="width: 800px;" title="ORM"/></p>
<h4 id="сохранение-отдельных-полей">Сохранение отдельных полей</h4>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-27.png" style="width: 800px;" title="ORM"/></p>
<h4 id="автоматическое-увеличение-значения-поля">Автоматическое увеличение значения поля</h4>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-28.png" style="width: 800px;" title="ORM"/></p>
<h4 id="автоматическое-увеличение-значения-нескольких-полей">Автоматическое увеличение значения нескольких полей</h4>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-29.png" style="width: 800px;" title="ORM"/></p>
<p>Также имеется возможность автоматического уменьшения значений полей (decrement()).</p>
<h3 id="основы-выполнения-запросов">Основы выполнения запросов</h3>
<h4 id="создание-экземпляра">Создание экземпляра</h4>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-30.png" style="width: 800px;" title="ORM"/></p>
<h4 id="создание-экземпляра-с-определёнными-полями">Создание экземпляра с определёнными полями</h4>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-31.png" style="width: 800px;" title="ORM"/></p>
<h4 id="получение-экземпляра">Получение экземпляра</h4>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-32.png" style="width: 800px;" title="ORM"/></p>
<h4 id="выборка-полей">Выборка полей</h4>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-33.png" style="width: 800px;" title="ORM"/></p>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-34.png" style="width: 800px;" title="ORM"/></p>
<p>Настройка where позволяет выполнять фильтрацию возвращаемых данных. Существует большое количество операторов, которые могут использоваться совместно с where через Op.</p>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-35.png" style="width: 800px;" title="ORM"/></p>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-36.png" style="width: 800px;" title="ORM"/></p>
<h4 id="операторы">Операторы</h4>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-37.png" style="width: 800px;" title="ORM"/></p>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-38.png" style="width: 800px;" title="ORM"/></p>
<p>Передача массива в where приводит к неявному применению оператора IN:</p>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-39.png" style="width: 800px;" title="ORM"/></p>
<p>Операторы Op.and, Op.or и Op.not могут использоваться для создания сложных операций, связанных с логическими сравнениями:</p>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-40.png" style="width: 800px;" title="ORM"/></p>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-41.png" style="width: 800px;" title="ORM"/></p>
<h4 id="более-сложные-запросы">Более сложные запросы</h4>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-42.png" style="width: 800px;" title="ORM"/></p>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-43.png" style="width: 800px;" title="ORM"/></p>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-44.png" style="width: 800px;" title="ORM"/></p>
<h4 id="обновление-экземпляра">Обновление экземпляра</h4>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-45.png" style="width: 800px;" title="ORM"/></p>
<h4 id="удаление-экземпляра">Удаление экземпляра</h4>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-46.png" style="width: 800px;" title="ORM"/></p>
<h4 id="создание-нескольких-экземпляров-одновременно">Создание нескольких экземпляров одновременно</h4>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-47.png" style="width: 800px;" title="ORM"/></p>
<h4 id="сортировка-и-группировка">Сортировка и группировка</h4>
<p>Настройка order определяет порядок сортировки возвращаемых объектов:</p>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-48.png" style="width: 800px;" title="ORM"/></p>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-49.png" style="width: 800px;" title="ORM"/></p>
<p>Синтаксис группировки идентичен синтаксису сортировки, за исключением того, что при группировке не указывается направление. Кроме того, синтаксис группировки может быть сокращен до строки как на слайде сверху
Настройки limit и offset позволяют ограничивать и/или пропускать определенное количество возвращаемых объектов как на слайде снизу</p>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-50.png" style="width: 800px;" title="ORM"/></p>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-51.png" style="width: 800px;" title="ORM"/></p>
<h4 id="полезные-операторы">Полезные операторы</h4>
<p>Sequelize предоставляет несколько полезных утилит:</p>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-52.png" style="width: 800px;" title="ORM"/></p>
<h3 id="поисковые-запросы">Поисковые запросы</h3>
<p>Настройка raw со значением true отключает “оборачивание” ответа, возвращаемого SELECT, в экземпляр модели.</p>
<ul>
<li>findAll() — возвращает все экземпляры модели</li>
<li>findByPk() — возвращает один экземпляр по первичному ключу
как на слайде вверху</li>
</ul>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-53.png" style="width: 800px;" title="ORM"/></p>
<ul>
<li>findOne() — возвращает первый или один экземпляр модели (это зависит от того, указано ли условие для поиска)
как на слайде в центре</li>
</ul>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-54.png" style="width: 800px;" title="ORM"/></p>
<p>findOrCreate() — возвращает или создает и возвращает экземпляр, а также логическое значение — индикатор создания экземпляра. Настройка defaults используется для определения значений по умолчанию. При ее отсутствии, для заполнения полей используется значение, указанное в условии
как на слайде внизу</p>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-55.png" style="width: 800px;" title="ORM"/></p>
<h4 id="findandcountall">findAndCountAll()</h4>
<p>findAndCountAll() — комбинация findAll() и count. Может быть полезным при использовании настроек limit и offset, когда мы хотим знать точное число записей, совпадающих с запросом. Возвращает объект с двумя свойствами:
count — количество записей, совпадающих с запросом (целое число) 
rows — массив объектов</p>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-56.png" style="width: 800px;" title="ORM"/></p>
<h3 id="геттеры-сеттеры-и-виртуальные-атрибуты">Геттеры, сеттеры и виртуальные атрибуты</h3>
<p>Sequelize позволяет определять геттеры и сеттеры для атрибутов моделей, а также виртуальные атрибуты — атрибуты, которых не существует в таблице и которые заполняются или наполняются (имеется ввиду популяция) Serquelize автоматически. Последние могут использоваться, например, для упрощения кода.</p>
<p>Геттер — это функция get(), определенная для колонки как в верхней части слайда</p>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-57.png" style="width: 800px;" title="ORM"/></p>
<p>Геттер вызывается автоматически при чтении поля.</p>
<p>Обратите внимание: для получения значения поля в геттере мы использовали метод getDataValue(). Если вместо этого указать this.username, то мы попадем в бесконечный цикл.</p>
<p>Сеттер — это функция set(), определенная для колонки. Она принимает значение для установки как в нижней части слайда</p>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-58.png" style="width: 800px;" title="ORM"/></p>
<h4 id="автоматический-вызов-сеттера">Автоматический вызов сеттера</h4>
<p>Сеттер вызывается автоматически при создании экземпляра.
В сеттере можно использовать значения других полей:</p>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-59.png" style="width: 800px;" title="ORM"/></p>
<h4 id="совместное-использование">Совместное использование</h4>
<p>Геттеры и сеттеры можно использовать совместно. Допустим, что у нас имеется модель Post с полем content неограниченной длины, и в целях экономии памяти мы решили хранить в БД содержимое поста в сжатом виде. Обратите внимание: многие современные БД выполняют сжатие (компрессию) данных автоматически.</p>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-60.png" style="width: 800px;" title="ORM"/></p>
<h4 id="сжатие-данных">Сжатие данных</h4>
<p>Представим, что у нас имеется модель User с полями firstName и lastName, и мы хотим получать полное имя пользователя. Для этого мы можем создать виртуальный атрибут со специальным типом DataTypes.VIRTUAL:
В таблице не будет колонки fullName, однако мы сможем получать значение этого поля, как если бы оно существовало на самом деле.</p>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-61.png" style="width: 800px;" title="ORM"/></p>
<h4 id="валидация-и-ограничения">Валидация и ограничения</h4>
<p>Наша моделька будет выглядеть так:
Отличие между выполнением валидации и применением или наложением органичение на значение поля состоит в следующем:</p>
<p>валидация выполняется на уровне Sequelize; для ее выполнения можно использовать любую функцию, как встроенную, так и кастомную; при провале валидации, SQL-запрос в БД не отправляется;
ограничение определяется на уровне SQL; примером ограничения является настройка unique; при провале ограничения, запрос в БД все равно отправляется</p>
<p>В приведенном примере мы ограничили уникальность имени пользователя с помощью настройки unique. При попытке записать имя пользователя, которое уже существует в БД, возникнет ошибка SequelizeUniqueConstraintError.</p>
<p>По умолчанию колонки таблицы могут быть пустыми (нулевыми). Настройка allowNull со значением false позволяет это запретить. Обратите внимание: без установки данной настройки хотя бы для одного поля, можно будет выполнить такой запрос: User.create({}).</p>
<p>Валидаторы позволяют проводить проверку в отношении каждого атрибута модели. Валидация автоматически выполняется при запуске методов create(), update() и save(). Ее также можно запустить вручную с помощью validate().</p>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-62.png" style="width: 800px;" title="ORM"/></p>
<h4 id="validatorjs">validator.js</h4>
<p>Как было отмечено ранее, мы можем определять собственные валидаторы или использовать встроенные (предоставляемые библиотекой validator.js).</p>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-63.png" style="width: 800px;" title="ORM"/></p>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-64.png" style="width: 800px;" title="ORM"/></p>
<h4 id="кастомизация-сообщения-об-ошибке">Кастомизация сообщения об ошибке</h4>
<p>Для кастомизации сообщения об ошибке можно использовать объект со свойством msg как на слайде сверху</p>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-65.png" style="width: 800px;" title="ORM"/></p>
<p>В этом случае для указания аргументов используется свойство args. Как на слайде по средедине</p>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-66.png" style="width: 800px;" title="ORM"/></p>
<p>Для поля, которое может иметь значение null, встроенные валидаторы пропускаются. Это означает, что мы, например, можем определить поле, которое либо должно содержать строку длиной 5-10 символов, либо должно быть пустым: Как внизу на слйде</p>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-67.png" style="width: 800px;" title="ORM"/></p>
<h4 id="кастомные-валидаторы-для-нулевых-полей">Кастомные валидаторы для нулевых полей</h4>
<p>Обратите внимание, что для нулевых полей кастомные валидаторы выполняются:</p>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-68.png" style="width: 800px;" title="ORM"/></p>
<h4 id="валидация-модели-в-целом">Валидация модели в целом</h4>
<p>Мы можем выполнять валидацию не только отдельных полей, но и модели в целом. В следующем примере мы проверяем наличие или отсутствии как поля latitude, так и поля longitude (либо должны быть указаны оба поля, либо не должно быть указано ни одного):</p>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-69.png" style="width: 800px;" title="ORM"/></p>
<h3 id="необработанные-запросы">Необработанные запросы</h3>
<p>sequelize.query() позволяет выполнять необработанные SQL-запросы (raw queries). По умолчанию данная функция возвращает массив с результатами и объект с метаданными, при этом, содержание последнего зависит от используемого диалекта. На слайде вверху</p>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-70.png" style="width: 800px;" title="ORM"/></p>
<p>Если нам не нужны метаданные, для правильного форматирования результата можно воспользоваться специальными типами запроса (query types). В середине слайда</p>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-71.png" style="width: 800px;" title="ORM"/></p>
<p>Для привязки результатов необработанного запроса к модели используются настройки model и, опционально, mapToModel:. Внизу слайда</p>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-72.png" style="width: 800px;" title="ORM"/></p>
<h4 id="пример-использования-других-настроек">Пример использования других настроек</h4>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-73.png" style="width: 800px;" title="ORM"/></p>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-74.png" style="width: 800px;" title="ORM"/></p>
<h4 id="настройка-nest">Настройка nest</h4>
<p>Если название атрибута в таблице содержит точки, то результирующий объект может быть преобразован во вложенные объекты с помощью настройки nest.</p>
<p>Без nest: true: на слайде вверху</p>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-75.png" style="width: 800px;" title="ORM"/></p>
<p>С nest: true: на слайде внизу</p>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-76.png" style="width: 800px;" title="ORM"/></p>
<h4 id="замены-в-запросе">Замены в запросе</h4>
<p>Замены при выполнении запроса могут производиться двумя способами:</p>
<p>с помощью именованных параметров (начинающихся с :)
с помощью неименованных параметров (представленных ?)</p>
<p>Заменители (placeholders) передаются в настройку replacements в виде массива (для неименованных параметров) или в виде объекта (для именованных параметров):</p>
<p>если передан массив, ? заменяется элементами массива в порядке их следования
если передан объект, :key заменяются ключами объекта. При отсутствии в объекте ключей для заменяемых значений, а также в случае, когда ключей в объекте больше, чем заменяемых значений, выбрасывается исключение</p>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-77.png" style="width: 800px;" title="ORM"/></p>
<p>Более сложные примеры замены в нижней  части слайде</p>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-78.png" style="width: 800px;" title="ORM"/></p>
<h4 id="привязка-параметров">Привязка параметров</h4>
<p>Кроме замены, можно выполнять привязку (bind) параметров. Привязка похожа на замену, но заменители обезвреживаются (escaped) и вставляются в запрос, отправляемый в БД, а связанные параметры отправляются в БД по отдельности. Связанные параметры обозначаются с помощью $число или $строка:</p>
<p>если передан массив, $1 будет указывать на его первый элемент (bind[0])
если передан объект, $key будет указывать на object[‘key’]. Каждый ключ объекта должен начинаться с буквы. $1 является невалидным ключом, даже если существует object[‘1’]
в обоих случаях для сохранения знака $ может использоваться $$</p>
<p>Связанные параметры не могут быть ключевыми словами SQL, названиями таблиц или колонок. Они игнорируются внутри текста, заключенного в кавычки. Кроме того, в postgres может потребоваться указывать тип связываемого параметра в случае, когда он не может быть выведен на основании контекста — $1::varchar.</p>
<p><img alt="ORM" class="align-center" src="/assets/images/wd_text/wd43-79.png" style="width: 800px;" title="ORM"/></p>
</section>
<footer class="page__meta">
<p class="page__date"><strong><i aria-hidden="true" class="fas fa-fw fa-calendar-alt"></i> Дата изменения:</strong> <time datetime="2022-09-27T12:49:07+00:00">September 27, 2022</time></p>
</footer>
<nav class="pagination">
<a class="pagination--pager" href="/text/wd42/" title="Основы Express.js
">Предыдущая</a>
<a class="pagination--pager disabled" href="#">Следующая</a>
</nav>
</div>
</article>
<div class="page__related">
<h4 class="page__related-title">Вам также может понравиться</h4>
<div class="grid__wrapper">
<div class="grid__item">
<article class="archive__item" itemscope="" itemtype="https://schema.org/CreativeWork">
<div class="archive__item-teaser">
<img alt="" src="http://brightmagazine.ru/wp-content/uploads/2022/10/christina-wocintechchat-com-qZYNQp_Lm3o-unsplash.jpg"/>
</div>
<h2 class="archive__item-title no_toc" itemprop="headline">
<a href="http://brightmagazine.ru/ie/">Сколько получают IT-специалисты в России?
</a> <a href="/talks/bright-brains/" rel="permalink"><i aria-hidden="true" class="fas fa-link" title="permalink"></i><span class="sr-only">Permalink</span></a>
</h2>
<p class="page__meta">
<span class="page__meta-date">
<i aria-hidden="true" class="far fa-fw fa-calendar-alt"></i>
<time datetime="2022-09-26T00:00:00+00:00">September 26, 2022</time>
</span>
<span class="page__meta-sep"></span>
<span class="page__meta-readtime">
<i aria-hidden="true" class="far fa-fw fa-clock"></i>
        
          менее 1 мин на чтение
        
                
      </span>
</p>
<p class="archive__item-excerpt" itemprop="description">Вместе с заместителем декана по учебной работе Финансового университета при Правительстве РФ, кандидатом экономических наук, Михаилом Коротеевым разбираемся ...</p>
</article>
</div>
<div class="grid__item">
<article class="archive__item" itemscope="" itemtype="https://schema.org/CreativeWork">
<div class="archive__item-teaser">
<img alt="" src="https://brightmagazine.ru/wp-content/uploads/2022/05/pexels-george-morina-4960341.jpg"/>
</div>
<h2 class="archive__item-title no_toc" itemprop="headline">
<a href="https://brightmagazine.ru/proit/">Сколько получают IT-специалисты в России?
</a> <a href="/talks/bright-it-salaries/" rel="permalink"><i aria-hidden="true" class="fas fa-link" title="permalink"></i><span class="sr-only">Permalink</span></a>
</h2>
<p class="page__meta">
<span class="page__meta-date">
<i aria-hidden="true" class="far fa-fw fa-calendar-alt"></i>
<time datetime="2022-05-04T00:00:00+00:00">May 4, 2022</time>
</span>
<span class="page__meta-sep"></span>
<span class="page__meta-readtime">
<i aria-hidden="true" class="far fa-fw fa-clock"></i>
        
          менее 1 мин на чтение
        
                
      </span>
</p>
<p class="archive__item-excerpt" itemprop="description">Среди молодых специалистов России укоренился стереотип о том, что программисты, специалисты по ИТ «несправедливо» много зарабатывают. Насколько он оправдан, ...</p>
</article>
</div>
<div class="grid__item">
<article class="archive__item" itemscope="" itemtype="https://schema.org/CreativeWork">
<h2 class="archive__item-title no_toc" itemprop="headline">
<a href="https://www.youtube.com/playlist?list=PLhgyvraU60gUz40uPfZcCO6ar7dw7PCqs">Android-разработка
</a> <a href="/course/android-playlist/" rel="permalink"><i aria-hidden="true" class="fas fa-link" title="permalink"></i><span class="sr-only">Permalink</span></a>
</h2>
<p class="page__meta">
<span class="page__meta-date">
<i aria-hidden="true" class="far fa-fw fa-calendar-alt"></i>
<time datetime="2022-03-16T00:00:00+00:00">March 16, 2022</time>
</span>
<span class="page__meta-sep"></span>
<span class="page__meta-readtime">
<i aria-hidden="true" class="far fa-fw fa-clock"></i>
        
          менее 1 мин на чтение
        
                
      </span>
</p>
<p class="archive__item-excerpt" itemprop="description">Цикл видеолекций по разработке мобильных приложений для Android на языке Java.
</p>
</article>
</div>
<div class="grid__item">
<article class="archive__item" itemscope="" itemtype="https://schema.org/CreativeWork">
<h2 class="archive__item-title no_toc" itemprop="headline">
<a href="https://www.youtube.com/playlist?list=PLhgyvraU60gU8OAhjtcipU_sO7UYvkQl9">UNIX
</a> <a href="/course/linux-playlist/" rel="permalink"><i aria-hidden="true" class="fas fa-link" title="permalink"></i><span class="sr-only">Permalink</span></a>
</h2>
<p class="page__meta">
<span class="page__meta-date">
<i aria-hidden="true" class="far fa-fw fa-calendar-alt"></i>
<time datetime="2021-06-20T00:00:00+00:00">June 20, 2021</time>
</span>
<span class="page__meta-sep"></span>
<span class="page__meta-readtime">
<i aria-hidden="true" class="far fa-fw fa-clock"></i>
        
          менее 1 мин на чтение
        
                
      </span>
</p>
<p class="archive__item-excerpt" itemprop="description">Цикл видеолекций по операционной системе Linux.
</p>
</article>
</div>
</div>
</div>
</div>
</div>
<div class="page__footer" id="footer">
<footer>
<!-- start custom footer snippets -->
<!-- end custom footer snippets -->
<div class="page__footer-follow">
<ul class="social-icons">
<li><strong>Связаться со мной:</strong></li>
<li><a href="https://vk.com/koroteev_m" rel="nofollow noopener noreferrer"><i aria-hidden="true" class="fab fa-fw fa-vk"></i> Vkontakte</a></li>
<li><a href="https://twitter.com/koroteev_m" rel="nofollow noopener noreferrer"><i aria-hidden="true" class="fab fa-fw fa-twitter-square"></i> Twitter</a></li>
<li><a href="/feed.xml"><i aria-hidden="true" class="fas fa-fw fa-rss-square"></i> RSS-лента</a></li>
</ul>
</div>
<div class="page__footer-copyright">© 2022 Михаил Коротеев. Сайт работает на <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>
</footer>
</div>
<script src="/assets/js/main.min.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-1K09X3NDBE"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-1K09X3NDBE', { 'anonymize_ip': false});
</script>
<!-- Yandex.Metrika counter -->
<script type="text/javascript">
   (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
   m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
   (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

   ym(77706580, "init", {
        clickmap:true,
        trackLinks:true,
        accurateTrackBounce:true
   });
</script>
<noscript><div><img alt="" src="https://mc.yandex.ru/watch/77706580" style="position:absolute; left:-9999px;"/></div></noscript>
<!-- /Yandex.Metrika counter -->
<script async="" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML" type="text/javascript">
</script>
<script type="text/x-mathjax-config">
   MathJax.Hub.Config({
     extensions: ["tex2jax.js"],
     jax: ["input/TeX", "output/HTML-CSS"],
     tex2jax: {
       inlineMath: [ ['$','$'], ["\\(","\\)"] ],
       displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
       processEscapes: true
     },
     "HTML-CSS": { availableFonts: ["TeX"] }
   });
</script>
<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
</body>
</html>
